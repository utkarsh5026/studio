(function(){"use strict";function d(r,t){return Math.sqrt(r.reduce((a,o,e)=>a+Math.pow(o-t[e],2),0))}function g(r,t){return r.every((a,o)=>a.every((e,n)=>e===t[o][n]))}function p(r){const t=[];for(let n=0;n<r.length;n+=4)t.push([r[n],r[n+1],r[n+2]]);const a=5,o=20;let e=Array.from({length:a},()=>{const n=Math.floor(Math.random()*t.length);return[...t[n]]});for(let n=0;n<o;n++){const u=Array.from({length:a},()=>[]);for(const c of t){let i=1/0,f=0;e.forEach((l,h)=>{const m=d(c,l);m<i&&(i=m,f=h)}),u[f].push(c)}const s=u.map(c=>c.length===0?e[0]:c.reduce((i,f)=>i.map((l,h)=>l+f[h]),[0,0,0]).map(i=>Math.round(i/c.length)));if(g(e,s))break;e=s}return e.map(([n,u,s])=>({r:n,g:u,b:s}))}function y(r){let t=0;const a=r.length/4;for(let o=0;o<r.length;o+=4){const e=r[o]/255,n=r[o+1]/255,u=r[o+2]/255,s=Math.max(e,n,u),c=Math.min(e,n,u),i=s===0?0:(s-c)/s;t+=i}return t/a}self.onmessage=r=>{try{const{type:t,pixels:a}=r.data;let o;if(t==="dominantColors")o=p(a);else if(t==="saturation")o=y(a);else throw new Error(`Unknown operation type: ${t}`);self.postMessage(o)}catch(t){self.postMessage({error:t instanceof Error?t:new Error(String(t))})}}})();
